<!doctype html>
<html lang="es">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>NutriFit</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Roboto+Condensed:ital,wght@0,100..900;1,100..900&display=swap" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <link rel="stylesheet" href="css/styles.css">
    <script src="script.js"></script>
  </head>
  <body>
    <div class="container my-5 vh-100"> <!-- Añadido margen superior -->
      <div class="row align-items-center justify-content-center text-center h-100"> <!-- Alinea elementos verticalmente -->
        <div class="col"> <!-- Añadido margen superior -->
          <form class="form" id="loginForm" action="/" method="get">
            <h1>Iniciar sesión</h1> 
            <div class="form-group"> 
              <div class="d-inline-flex p-2">
                <input type="text" name="userID" class="form-control text-start space-bottom" id="userID" aria-describedby="emailHelp" placeholder="Nombre de usuario" required>
              </div>
            </div>
            <div class="form-group">
              <div class="d-inline-flex p-2">
                <input type="password" name="password" class="form-control text-start space-bottom" id="passinput" placeholder="Contraseña" required>
              </div>
            </div>
            <div class="form-group">
              <div class="d-inline-flex p-2">
                <button type="submit" class="btn btn-dark">Iniciar sesión</button>
              </div>
            </div>  
          </form>
          <form class="form" id="registerForm" style="display: none;" action="/" method="post">
            <h1>Registro</h1>
            <hr>
            <div class="form-group">
              <div class="d-inline-flex p-2">
                <label id="formhelp">Email</label>
              </div>
              <div class="d-inline-flex p-2">
                <input type="email" id="email" class="form-control text-center margen" id="email" placeholder="ejemplo@correo.com" required>
              </div>
            </div>
            
            <div class="form-group">
              <div class="d-inline-flex p-2">
                <label id="formhelp">Nombre</label>
              </div>
              <div class="d-inline-flex p-2">
                <input type="text" name="nombre" class="form-control text-center" id="userName" required>
              </div>
            </div>
            <div class="form-group">
              <div class="d-inline-flex p-2">
                <label id="formhelp">Apellido</label>
              </div>
              <div class="d-inline-flex p-2">
                <input type="text" name="apellido" class="form-control text-center" id="userName" required>
              </div>
            </div>
            <div class="form-group">
              <div class="d-inline-flex p-2">
                <label id="formhelp">RUT</label>
              </div>
              <div class="d-inline-flex p-2">
                <input type="text" name="rut" class="form-control text-center" id="rut">
              </div>
            </div>
            <div class="form-group">
              <div class="d-inline-flex p-2">
                <label id="formhelp">F. de Nacimiento</label>
                <input type="date" id="bddate" required>
              </div>
              <div class="form-group">
                <div class="d-inline-flex p-2">
                    <label id="formhelp">RUT</label>
                </div>
                <div class="d-inline-flex p-2">
                    <input type="text" name="rut" class="form-control text-center" id="rut" placeholder="XXXXXXX-X">
                    <!-- Elemento para mostrar mensaje de error del RUT -->
                    <span id="error" class="text-danger"></span>
                </div>
            </div>
            </div>
            <div class="form-group">
              <div class="d-inline-flex p-2">
                <label id="formhelp">Region</label>
                <select class="form-select" id="regionSelect">
                  <option value="">Selecciona una región</option>
                </select>
                <br>
                <label id="formhelp">Comuna</label>
                <select class="form-select" id="comunaSelect">
                  <option value="">Selecciona una comuna</option>
                </select>
              </div>

            </div>
           
            <div class="form-group">
              <div class="d-inline-flex p-2">
                <label id="formhelp">Peso (Kg.)</label>
              </div>
              <div class="d-inline-flex p-2">
                <input type="number" name="apellido" class="form-control text-center" id="userName" min="30">
                
              </div>
            </div>
            <div class="form-group">
              <div class="d-inline-flex p-2">
                <label id="formhelp">Estatura (cm)</label>
              </div>
              <div class="d-inline-flex p-2">
                <input type="number" name="estatura" class="form-control text-center" id="userName" min="100" required>
                
              </div>
            </div>
            <div class="form-group">
              <div class="d-inline-flex p-2">
                <label id="formhelp">Contraseña</label>
              </div>
              <div class="d-inline-flex p-2">
                <input type="password" name="password" class="form-control text-center" id="password" required>
              </div>
            </div>
            <div class="form-group">
              <div class="d-inline-flex p-2">
                <label id="formhelp">Confirma Contraseña</label>
              </div>
              <div class="d-inline-flex p-2">
                <input type="password" name="password" class="form-control text-center" id="password" required>
              </div>
            </div>
            <div class="form-check">
              <input type="checkbox" class="form-check-input align-items-center" id="terminosycond" required>
              <label class="form-check-label align-items-center" for="terminosycond">Acepta terminos y condiciones.</label>
            </div>
            <div class="form-group">
              <div class="d-inline-flex p-2">
                <button type="btnvalida" class="btn btn-dark">Registrarse</button>
                <p>&nbsp;</p>
      <p class="text-info" id="msgerror"></p>
              </div>
            </div>  
          </form>
        </div>
        <div class="col my-5"> <!-- Añadido margen superior -->
          <h1>¿No tienes cuenta?</h1>
          <br>
          <button id="registerButton" class="btn btn-dark">Regístrate</button>
        </div>
      </div>
    </div>
    <!-- bootstrap + popper por si usamos algunas animaciones-->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.min.js" integrity="sha384-0pUGZvbkm6XF6gxjEnlmuGrJXVbNuzT9qBBavbLwCsOGabYfZo0T0to5eqruptLy" crossorigin="anonymous"></script>
    <!--Script registro-->
    <script>
      document.addEventListener('DOMContentLoaded', function() {
          const registerButton = document.querySelector('#registerButton');
          const loginForm = document.querySelector('#loginForm');
          const registerForm = document.querySelector('#registerForm');

          registerButton.addEventListener('click', function() {
              loginForm.style.display = 'none';
              registerForm.style.display = 'block';
          });
      });
  </script>
  <!-- Script de regiones y comunas -->
  <script>
      // Cargar datos del archivo JSON
      fetch('comunas-regiones.json')
          .then(response => response.json())
          .then(data => {
              const regionSelect = document.getElementById('regionSelect');
              const comunaSelect = document.getElementById('comunaSelect');

              data.regiones.forEach(region => {
                  const option = document.createElement('option');
                  option.value = region.nombre;
                  option.textContent = region.nombre;
                  regionSelect.appendChild(option);
              });

              regionSelect.addEventListener('change', () => {
                  comunaSelect.innerHTML = '<option value="">Selecciona una comuna</option>';

                  const selectedRegion = data.regiones.find(region => region.nombre === regionSelect.value);
                  if (selectedRegion) {
                      selectedRegion.comunas.forEach(comuna => {
                          const option = document.createElement('option');
                          option.value = comuna;
                          option.textContent = comuna;
                          comunaSelect.appendChild(option);
                      });
                  }
              });
          })
          .catch(error => console.error('Error al cargar el archivo JSON:', error));
  </script>
  <!-- Script de validación de formulario -->
  <script>
      document.addEventListener('DOMContentLoaded', function() {
          const form = document.getElementById('registerForm');
          const rutInput = document.getElementById('rut');
          const msgError = document.getElementById('msgerror');

          form.addEventListener('submit', function(event) {
              event.preventDefault(); // Evitar envío automático del formulario

              const rutValue = rutInput.value;

              if (!validarRut(rutValue)) {
                  msgError.textContent = 'RUT inválido';
                  msgError.style.color = 'red';
                  return;
              }

              this.submit();
          });
      });

      function validarRut(rut) {
          rut = rut.replace(/\./g, '').replace('-', '');

          var rutSplit = rut.split('');
          var rutBase = rutSplit.slice(0, -1).join('');
          var rutDV = rutSplit.slice(-1)[0].toUpperCase();

          if (!/^[0-9]+$/g.test(rutBase)) return false;

          var suma = 0;
          var multiplo = 2;
          for (var i = rutBase.length - 1; i >= 0; i--) {
              suma += parseInt(rutBase.charAt(i)) * multiplo;
              multiplo = multiplo === 7 ? 2 : multiplo + 1;
          }
          var dvEsperado = 11 - (suma % 11);
          if (dvEsperado === 11) dvEsperado = 0;
          if (dvEsperado === 10) dvEsperado = 'K';

          return rutDV === dvEsperado.toString();
      }
  </script>
  </body>
</html>
